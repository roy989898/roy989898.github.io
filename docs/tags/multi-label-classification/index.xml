<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Multi-Label Classification on Terminal</title>
    <link>https://roy989898.github.io/tags/multi-label-classification/</link>
    <description>Recent content in Multi-Label Classification on Terminal</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 16 May 2021 16:59:46 +0800</lastBuildDate><atom:link href="https://roy989898.github.io/tags/multi-label-classification/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Ai Tutorial 6.3 Other Computer Vision Problems-Multi-Label Binary Cross-Entropy</title>
      <link>https://roy989898.github.io/posts/ai-tutorial-6.3/</link>
      <pubDate>Sun, 16 May 2021 16:59:46 +0800</pubDate>
      
      <guid>https://roy989898.github.io/posts/ai-tutorial-6.3/</guid>
      <description>some python basic partial
def say_hello(name, say_what=&amp;#34;Hello&amp;#34;): return f&amp;#34;{say_what} {name}.&amp;#34; say_hello(&amp;#39;Jeremy&amp;#39;),say_hello(&amp;#39;Jeremy&amp;#39;, &amp;#39;Ahoy!&amp;#39;) # (&amp;#39;Hello Jeremy.&amp;#39;, &amp;#39;Ahoy! Jeremy.&amp;#39;) f = partial(say_hello, say_what=&amp;#34;Bonjour&amp;#34;) f(&amp;#34;Jeremy&amp;#34;),f(&amp;#34;Sylvain&amp;#34;) # (&amp;#39;Bonjour Jeremy.&amp;#39;, &amp;#39;Bonjour Sylvain.&amp;#39;) Binary Cross-Entropy a Learner object contains four main things: the model, a DataLoaders object, an Optimizer, and the loss function to use. we use resnet models (teach later),we know howto build SGD optimizer(lesson 4) and the dataloader,so we look focus on the loss function.</description>
      <content>&lt;h1 id=&#34;some-python-basic&#34;&gt;some python basic&lt;/h1&gt;
&lt;p&gt;partial&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;say_hello&lt;/span&gt;(name, say_what&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;): &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; f&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{say_what} {name}.&amp;#34;&lt;/span&gt;
say_hello(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Jeremy&amp;#39;&lt;/span&gt;),say_hello(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Jeremy&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Ahoy!&amp;#39;&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;# (&amp;#39;Hello Jeremy.&amp;#39;, &amp;#39;Ahoy! Jeremy.&amp;#39;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;f &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; partial(say_hello, say_what&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bonjour&amp;#34;&lt;/span&gt;)
f(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Jeremy&amp;#34;&lt;/span&gt;),f(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Sylvain&amp;#34;&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;# (&amp;#39;Bonjour Jeremy.&amp;#39;, &amp;#39;Bonjour Sylvain.&amp;#39;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;binary-cross-entropy&#34;&gt;Binary Cross-Entropy&lt;/h1&gt;
&lt;p&gt;a Learner object contains four main things: the model, a DataLoaders object, an Optimizer, and the loss function to use.
we use resnet models (teach later),we know howto build SGD optimizer(lesson 4) and the dataloader,so we look focus on the &lt;em&gt;loss function&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;learn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cnn_learner(dls, resnet18)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;seeone batch&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;x,y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; to_cpu(dls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;one_batch())
x[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;shape

&lt;span style=&#34;color:#75715e&#34;&gt;# torch.Size([3, 128, 128])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# pass the independernt vairable to the model,to gte the activs &lt;/span&gt;
activs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;model(x)
activs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;shape
&lt;span style=&#34;color:#75715e&#34;&gt;# torch.Size([64, 20])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;why is this shape???torch.Size([64, 20]), because the match size is 64,and we have 20 categories,the activs, is for each image,the probability of each of 20 categories&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;activs
&lt;span style=&#34;color:#75715e&#34;&gt;# tensor([[ 0.7476, -1.1988,  4.5421,  ...,  0.7063, -1.3358, -0.3715],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         [-0.9919, -0.4608, -0.4424,  ..., -1.4165, -2.9962,  0.5873],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         [ 2.1179, -0.0294,  0.7001,  ...,  2.2310,  1.1888, -0.0595],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         ...,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         [-0.3535,  3.0212,  0.4811,  ...,  1.8732,  1.2486, -3.3234],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         [-1.4724, -2.8740, -1.2860,  ..., -2.7895, -1.8632, -0.1557],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         [-1.6487,  1.5647,  1.0682,  ..., -0.6979, -1.5629, -1.7217]], grad_fn=&amp;lt;MmBackward&amp;gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;we can see that the number still not between 0 and 1,but we can use the the loss function learn in lesson 4(mist_loss,because have sigmoid) and add log&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;binary_cross_entropy&lt;/span&gt;(inputs, targets):
    inputs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; inputs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sigmoid()
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;where(targets&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;-&lt;/span&gt;inputs, inputs)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;log()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mean()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;why we do not use the nll_loss or softmax thta lear in lesson 5????becuase it use for one image one tag,but ther is one imagfe maybe &amp;gt;1 tag or 0 tag&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;softmax&lt;/strong&gt;, as we saw, requires that all predictions sum to 1, and tends to push one activation to be much larger than the others (due to the use of exp); however, we may well have multiple objects that we&amp;rsquo;re confident appear in an image, so restricting the maximum sum of activations to 1 is not a good idea. By the same reasoning, we may want the sum to be less than 1, if we don&amp;rsquo;t think any of the categories appear in an image.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;nll_loss&lt;/strong&gt;, as we saw, returns the value of just one activation: the single activation corresponding with the single label for an item. This doesn&amp;rsquo;t make sense when we have multiple labels.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;pytorch already provide binary_cross_entropy&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;loss_func &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; nn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;BCEWithLogitsLoss()
loss &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; loss_func(activs, y)
loss

&lt;span style=&#34;color:#75715e&#34;&gt;# TensorMultiCategory(1.0342, grad_fn=&amp;lt;AliasBackward&amp;gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;However ,we do not need to require fastai use this loss function,!!! Becasue if fastai dataloaders know have multi categories ta a image, default use nn.BCEWithLogitsLoss&lt;/p&gt;
&lt;p&gt;we need to change the metric too,compare to the lesson 5&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# orginal one&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;accuracy&lt;/span&gt;(inp, targ, axis&lt;span style=&#34;color:#f92672&#34;&gt;=-&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;):
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Compute accuracy with `targ` when `pred` is bs * n_classes&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#75715e&#34;&gt;# select the mots hight valu one.but know we have multi category for a image&lt;/span&gt;
    pred &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; inp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;argmax(dim&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;axis)
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; (pred &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; targ)&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;float()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mean()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# suitable one&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# we need to set a value:thresh,to decide which is 1,whis is 0&lt;/span&gt;
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;accuracy_multi&lt;/span&gt;(inp, targ, thresh&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.5&lt;/span&gt;, sigmoid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;True):
    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Compute accuracy when `inp` and `targ` are the same size.&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; sigmoid: inp &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; inp&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;sigmoid()
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; ((inp&lt;span style=&#34;color:#f92672&#34;&gt;&amp;gt;&lt;/span&gt;thresh)&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;targ&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;bool())&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;float()&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;mean()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;now ,use the new metric start to train&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# start to train&lt;/span&gt;
learn &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; cnn_learner(dls, resnet50, metrics&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;partial(accuracy_multi, thresh&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.2&lt;/span&gt;))
learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;fine_tune(&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;, base_lr&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3e-3&lt;/span&gt;, freeze_epochs&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;)

&lt;span style=&#34;color:#75715e&#34;&gt;# epoch train_loss valid_loss accuracy_multi time&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 0 0.942215 0.698972 0.239303 00:26&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 0.824776 0.551198 0.290996 00:26&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2 0.607759 0.198789 0.827131 00:26&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3 0.361537 0.125557 0.943287 00:26&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# epoch train_loss valid_loss accuracy_multi time&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 0 0.134416 0.125471 0.934343 00:27&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 0.118428 0.105183 0.949880 00:27&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2 0.097109 0.102836 0.950040 00:27&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;after train we can chnage the metrics with different value of thresh If you pick a threshold that&amp;rsquo;s too low, you&amp;rsquo;ll often be failing to select correctly labeled objects&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metrics &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; partial(accuracy_multi, thresh&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.1&lt;/span&gt;)
learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;validate()
&lt;span style=&#34;color:#75715e&#34;&gt;# validation loss and metrics&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# [0.10283613950014114,0.9265138506889343]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;you&amp;rsquo;ll only be selecting the objects for which your model is very confident with a high thresh:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;metrics &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; partial(accuracy_multi, thresh&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.99&lt;/span&gt;)
learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;validate()
&lt;span style=&#34;color:#75715e&#34;&gt;# [0.10283613950014114,0.9433467388153076]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;we calculate one pred to test different thresh value&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# we can getpre and &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# the get_preds get all the valid data ,to calculate their pred,and the target&lt;/span&gt;
preds,targs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; learn&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;get_preds()

&lt;span style=&#34;color:#75715e&#34;&gt;# (tensor([[1.3728e-03, 3.1368e-03, 4.9623e-04,  ..., 4.6060e-01, 1.1935e-03, 9.1202e-02],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [3.3482e-04, 1.2069e-02, 1.0969e-03,  ..., 1.7647e-02, 1.6421e-03, 9.6689e-04],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [3.8831e-03, 1.3268e-02, 4.4939e-03,  ..., 1.1680e-02, 1.0579e-03, 2.7399e-03],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          ...,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [3.9797e-03, 5.1892e-03, 7.0612e-04,  ..., 3.0286e-03, 1.7749e-03, 7.1625e-03],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [8.4477e-03, 7.8008e-03, 1.7175e-03,  ..., 2.0243e-03, 2.5596e-02, 1.8781e-03],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [6.2252e-04, 9.4245e-01, 4.3180e-03,  ..., 8.6979e-03, 8.4691e-04, 5.2906e-03]]),&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  TensorMultiCategory([[0., 0., 0.,  ..., 0., 0., 0.],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [0., 0., 0.,  ..., 0., 0., 0.],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [0., 0., 0.,  ..., 0., 0., 0.],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          ...,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [0., 0., 0.,  ..., 0., 0., 0.],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [0., 0., 0.,  ..., 0., 0., 0.],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#          [0., 1., 0.,  ..., 0., 0., 0.]]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# at default ,get_preds applies the output activation function (sigmoid, in this case) for us, so we&amp;#39;ll need to tell accuracy_multi to not apply it:&lt;/span&gt;
accuracy_multi(preds, targs, thresh&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.9&lt;/span&gt;, sigmoid&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;False)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;use this way to find the best thresh value&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;xs = torch.linspace(0.05,0.95,29)
accs = [accuracy_multi(preds, targs, thresh=i, sigmoid=False) for i in xs]
plt.plot(xs,accs);
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;img src=&#34;https://roy989898.github.io/img/ai_t/t1/graph_tresh.PNG&#34; alt=&#34;graph_tresh&#34;&gt;&lt;/p&gt;
&lt;p&gt;In this case, we&amp;rsquo;re using the validation set to pick a hyperparameter (the threshold), which is the purpose of the validation set. Sometimes students have expressed their concern that we might be overfitting to the validation set, since we&amp;rsquo;re trying lots of values to see which is the best. However, as you see in the plot, changing the threshold in this case results in a smooth curve, so we&amp;rsquo;re clearly not picking some inappropriate outlier. This is a good example of where you have to be careful of the difference between theory (don&amp;rsquo;t try lots of hyperparameter values or you might overfit the validation set) versus practice (if the relationship is smooth, then it&amp;rsquo;s fine to do this).&lt;/p&gt;
&lt;p&gt;在這種情況下，我們使用驗證集來選擇一個超參數（閾值），這是驗證集的目的。 有時，學生表達了他們對我們可能過度適合驗證集的擔憂，因為我們正在嘗試大量的值以查看哪種值最好。 但是，正如您在圖中所看到的，在這種情況下，更改閾值會產生平滑的曲線，因此我們顯然不會選擇一些不合適的離群值。 這是一個很好的例子，說明您必須注意理論（不要嘗試過多的超參數值，否則可能會過度擬合驗證集）與實踐之間的差異（如果關係是平滑的，則可以這樣做） 。&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Ai Tutorial 6.2 Other Computer Vision Problems-Multi-Label Classification.2 Data Block</title>
      <link>https://roy989898.github.io/posts/ai-tutorial-6.2/</link>
      <pubDate>Sun, 16 May 2021 15:29:00 +0800</pubDate>
      
      <guid>https://roy989898.github.io/posts/ai-tutorial-6.2/</guid>
      <description>My Code 
Source Code 
Problems-Multi-Label Classification.2 Data Block Data Block in fast api and pytorch,we use Dataset and DataLoader to access the data
Pytorch
 Dataset:A collection that returns a tuple of your independent(image) and dependent variable(tag) for a single item DataLoader:: An iterator that provides a stream of mini-batches, where each mini-batch is a tuple of a batch of independent variables and a batch of dependent variables  Fastai provide</description>
      <content>&lt;p&gt;&lt;a href=&#34;https://colab.research.google.com/drive/1VzYTbBKx-JPfJ1FaLHOhG1Hpf3GNdG5C?usp=sharing&#34;&gt;My Code
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://colab.research.google.com/github/fastai/fastbook/blob/master/06_multicat.ipynb&#34;&gt;Source Code
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;problems-multi-label-classification2--data-block&#34;&gt;Problems-Multi-Label Classification.2  Data Block&lt;/h1&gt;
&lt;h2 id=&#34;data-block&#34;&gt;Data Block&lt;/h2&gt;
&lt;p&gt;in fast api and pytorch,we use Dataset and DataLoader to access the data&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Pytorch&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dataset:A collection that returns a tuple of your independent(image) and dependent variable(tag) for a single item&lt;/li&gt;
&lt;li&gt;DataLoader:: An iterator that provides a stream of mini-batches, where each mini-batch is a tuple of a batch of independent variables and a batch of dependent variables&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Fastai provide&lt;/em&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Datasets:: An object that contains a training Dataset and a validation Dataset&lt;/li&gt;
&lt;li&gt;DataLoaders:: An object that contains a training DataLoader and a validation DataLoader&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; fastai.vision.all &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
path &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; untar_data(URLs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;PASCAL_2007)
&lt;span style=&#34;color:#75715e&#34;&gt;# use the path read the csv to the dataframe&lt;/span&gt;
df &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pd&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read_csv(path&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;train.csv&amp;#39;&lt;/span&gt;)
df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;head()
&lt;span style=&#34;color:#75715e&#34;&gt;# fname labels is_valid&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 0 000005.jpg chair True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 000007.jpg car True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2 000009.jpg horse person True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3 000012.jpg car False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 4 000016.jpg bicycle True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;try to build a Datablock,not correct&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock()
dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# datasets contain train dataset and train dataset&lt;/span&gt;
len(dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train),len(dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;valid)

&lt;span style=&#34;color:#75715e&#34;&gt;# (4009, 1002)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;
x,y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
x,y
&lt;span style=&#34;color:#75715e&#34;&gt;# we can see that the x an  y is the same,this is not right&lt;/span&gt;

&lt;span style=&#34;color:#75715e&#34;&gt;# (fname       008663.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  labels      car person&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  is_valid         False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  Name: 4346, dtype: object, fname       008663.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  labels      car person&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  is_valid         False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  Name: 4346, dtype: object)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;build a Data block in correct way
we need to tell datablock,what is indepedent vairable (x) and depedent vairable(y) in the data frame&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://roy989898.github.io/img/ai_t/t1/df.PNG&#34; alt=&#34;df&#34;&gt;&lt;/p&gt;
&lt;p&gt;tell date block that,fname is the x,u is the labels&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(get_x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; r: r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;fname&amp;#39;&lt;/span&gt;], get_y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;lambda&lt;/span&gt; r: r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;])
dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
&lt;span style=&#34;color:#75715e&#34;&gt;# (&amp;#39;005620.jpg&amp;#39;, &amp;#39;aeroplane&amp;#39;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;same ,use function,not lambda&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_x&lt;/span&gt;(r): &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;fname&amp;#39;&lt;/span&gt;]
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_y&lt;/span&gt;(r): &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;]
dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(get_x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_x, get_y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_y)
dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# (&amp;#39;002549.jpg&amp;#39;, &amp;#39;tvmonitor&amp;#39;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;better,x is path, and y is more than two tag&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_x&lt;/span&gt;(r): &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; path&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;train&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;fname&amp;#39;&lt;/span&gt;]
&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;get_y&lt;/span&gt;(r): &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; r[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;labels&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;split(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39; &amp;#39;&lt;/span&gt;)
dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(get_x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_x, get_y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_y)
dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
&lt;span style=&#34;color:#75715e&#34;&gt;# (Path(&amp;#39;/root/.fastai/data/pascal_2007/train/002844.jpg&amp;#39;), [&amp;#39;train&amp;#39;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;more better,MultiCategoryBlock ,can return one-hot encoding&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# ategoryBlock return a number,MultiCategoryBlock return multi number&lt;/span&gt;
dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(ImageBlock, MultiCategoryBlock),
                   get_x &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_x, get_y &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; get_y)
dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 mean the image is the type,we can have a fix length of the array&lt;/span&gt;


&lt;span style=&#34;color:#75715e&#34;&gt;# (PILImage mode=RGB size=500x375,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  TensorMultiCategory([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0.]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;try to show the tag&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]
&lt;span style=&#34;color:#75715e&#34;&gt;# TensorMultiCategory([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0.])&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# this mean we have 20 avliable tag,and this picture tag is index 11 tag&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;get the 1 index number&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# get the index when ==1&lt;/span&gt;
torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;where(dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1.&lt;/span&gt;)
&lt;span style=&#34;color:#75715e&#34;&gt;# (TensorMultiCategory([11]),)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;show the tag&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# show the tag&lt;/span&gt;
idxs &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; torch&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;where(dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;][&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1.&lt;/span&gt;)[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]
idxs
&lt;span style=&#34;color:#75715e&#34;&gt;# TensorMultiCategory([11])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;vocab[idxs]
&lt;span style=&#34;color:#75715e&#34;&gt;# [&amp;#39;dog&amp;#39;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;handle is valid in the csv
at default,datablock random select he item to be valid item of train item&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;is_valid&amp;#39;&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# 0        True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1        True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2        True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3       False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 4        True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#         ...  &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5006     True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5007     True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5008     True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5009    False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5010    False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Name: is_valid, Length: 5011, dtype: bool&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;get the not is_valid index&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;index[&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;is_valid&amp;#39;&lt;/span&gt;]]

&lt;span style=&#34;color:#75715e&#34;&gt;# Int64Index([   3,    5,    9,   11,   13,   14,   15,   16,   17,   20,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#             ...&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#             4991, 4993, 4996, 4998, 4999, 5000, 5001, 5004, 5009, 5010],&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#            dtype=&amp;#39;int64&amp;#39;, length=2501)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;def&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;splitter&lt;/span&gt;(df):
    train &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;index[&lt;span style=&#34;color:#f92672&#34;&gt;~&lt;/span&gt;df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;is_valid&amp;#39;&lt;/span&gt;]]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tolist()
    valid &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;index[df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;is_valid&amp;#39;&lt;/span&gt;]]&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;tolist()
    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; train,valid

dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(ImageBlock, MultiCategoryBlock),
                   splitter&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;splitter,
                   get_x&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;get_x, 
                   get_y&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;get_y)

dsets &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;datasets(df)
dsets&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;train[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# (PILImage mode=RGB size=500x333,&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#  TensorMultiCategory([0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Final&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;dblock &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; DataBlock(blocks&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;(ImageBlock, MultiCategoryBlock),
                   splitter&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;splitter,
                   get_x&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;get_x, 
                   get_y&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;get_y,
                   item_tfms &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; RandomResizedCrop(&lt;span style=&#34;color:#ae81ff&#34;&gt;128&lt;/span&gt;, min_scale&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;0.35&lt;/span&gt;))
dls &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; dblock&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;dataloaders(df)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# show some sample&lt;/span&gt;
dls&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;show_batch(nrows&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, ncols&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://roy989898.github.io/img/ai_t/t1/batch_6.2.PNG&#34; alt=&#34;batch_6&#34;&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Ai Tutorial 6.1 Other Computer Vision Problems-Multi-Label Classification.1</title>
      <link>https://roy989898.github.io/posts/ai-tutorial-6.1/</link>
      <pubDate>Sun, 16 May 2021 15:03:29 +0800</pubDate>
      
      <guid>https://roy989898.github.io/posts/ai-tutorial-6.1/</guid>
      <description>My Code 
Source Code 
Multi-Label Classification a picture,can &amp;gt; 1 tag,or 0 tag
pandas dataframe tutorial the image that have more than one tag
from fastai.vision.all import * path = untar_data(URLs.PASCAL_2007) # use the path read the csv to the dataframe df = pd.read_csv(path/&amp;#39;train.csv&amp;#39;) df.head() # fname labels is_valid # 0 000005.jpg chair True # 1 000007.jpg car True # 2 000009.jpg horse person True # 3 000012.jpg car False # 4 000016.</description>
      <content>&lt;p&gt;&lt;a href=&#34;https://colab.research.google.com/drive/1VzYTbBKx-JPfJ1FaLHOhG1Hpf3GNdG5C?usp=sharing&#34;&gt;My Code
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://colab.research.google.com/github/fastai/fastbook/blob/master/06_multicat.ipynb&#34;&gt;Source Code
&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&#34;multi-label-classification&#34;&gt;Multi-Label Classification&lt;/h1&gt;
&lt;p&gt;a picture,can &amp;gt; 1 tag,or 0 tag&lt;/p&gt;
&lt;h2 id=&#34;pandas-dataframe-tutorial&#34;&gt;pandas dataframe tutorial&lt;/h2&gt;
&lt;p&gt;the image that have more than one tag&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#f92672&#34;&gt;from&lt;/span&gt; fastai.vision.all &lt;span style=&#34;color:#f92672&#34;&gt;import&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;
path &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; untar_data(URLs&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;PASCAL_2007)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# use the path read the csv to the dataframe&lt;/span&gt;
df &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; pd&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;read_csv(path&lt;span style=&#34;color:#f92672&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;train.csv&amp;#39;&lt;/span&gt;)
df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;head()

&lt;span style=&#34;color:#75715e&#34;&gt;# fname labels is_valid&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 0 000005.jpg chair True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 000007.jpg car True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2 000009.jpg horse person True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3 000012.jpg car False&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 4 000016.jpg bicycle True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dataframe get a column&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;fname&amp;#39;&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# 0       000005.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1       000007.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2       000009.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3       000012.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 4       000016.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;#            ...    &lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5006    009954.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5007    009955.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5008    009958.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5009    009959.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 5010    009961.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Name: fname, Length: 5011, dtype: object&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;dataframe get a row buy index&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;iloc[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# fname       000005.jpg&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# labels           chair&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# is_valid          True&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# Name: 0, dtype: object&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;get all row,first column&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;iloc[:,&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;get first row,all coumn&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;iloc[&lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;,:]

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;create dataframe&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df1&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;pd&lt;span style=&#34;color:#f92672&#34;&gt;.&lt;/span&gt;DataFrame()
df1[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;3&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;4&lt;/span&gt;]
df1

&lt;span style=&#34;color:#75715e&#34;&gt;# a&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 0 1&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1 2&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2 3&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3 4&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dataframe  operator&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-py&#34; data-lang=&#34;py&#34;&gt;df1[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;[&lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;20&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt;,&lt;span style=&#34;color:#ae81ff&#34;&gt;40&lt;/span&gt;]
df1[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;]&lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt;df1[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;b&amp;#39;&lt;/span&gt;]

&lt;span style=&#34;color:#75715e&#34;&gt;# 0    11&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 1    22&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 2    33&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# 3    44&lt;/span&gt;
&lt;span style=&#34;color:#75715e&#34;&gt;# dtype: int64&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content>
    </item>
    
  </channel>
</rss>
